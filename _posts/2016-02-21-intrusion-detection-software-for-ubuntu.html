---
title: Intrusion Detection Software for ubuntu 12.04
date: '2016-02-21T20:16:00.004-08:00'
author: bloggerming
tags: 
modified_time: '2016-02-21T20:17:56.828-08:00'
blogger_id: tag:blogger.com,1999:blog-3711184356900467447.post-510865082797484429
blogger_orig_url: http://technoming.blogspot.com/2016/02/intrusion-detection-software-for-ubuntu.html
---

This post is a guide on how to install 'snort' and Intrusion Detection Software for ubuntu 12.04.<br /><br />Install snort:<br />&nbsp; sudo apt-get install snort<br /><br />Make some changes to snort.conf:<br />&nbsp; sudo sed -i 's/include \$RULE\_PATH/#include \$RULE\_PATH/' /etc/snort/snort.conf<br /><br />Check the settings:<br />&nbsp; sudo /usr/local/bin/snort -q -u snort -g snort -c /etc/snort/snort.conf -i eth0<br /><br />More information on snort:<br />https://s3.amazonaws.com/snort-org-site/production/document_files/files/000/000/090/original/Snort_2.9.8.x_on_Ubuntu_12-14-15.pdf<br /><br />Snort writes data to log files. Barnyard2 reads logs and writes to a database.<br />This guide assumes that you have already installed mysql.<br />Create a mysql database:<br />&nbsp; echo "create database snort;" | mysql -u root -p<br />&nbsp; mysql -u root -p -D snort &lt; ~/snort_src/barnyard2-master/schemas/create_mysql<br /><br />Create a mysql user to work with snort:<br />&nbsp; echo "grant create, insert, select, delete, update on snort.* to \<br />&nbsp; snort@localhost identified by ’MYSQLSNORTPASSWORD’" | mysql -u root -p<br /><br />Install barnyard to convert snort messages:<br />&nbsp; wget http://download.aanval.com/barnyard2-1.9.tar.gz<br />&nbsp; tar -xvzf barnyard2-1.9.tar.gz<br />&nbsp; cd barnyard2-1.9<br />&nbsp; autoreconf -fvi -I ./m4 <br />&nbsp; ./configure --with-mysql --with-mysql-libraries=/usr/lib/i386-linux-gnu<br /><br />Edit barnyard2.conf:<br />&nbsp; sudo vi /etc/init/barnyard2.conf<br />&nbsp; output database: log, mysql, user=snort password=snort123 dbname=snort host=localhost<br /><br />Check settings:<br />&nbsp; sudo barnyard2 -c /etc/snort/barnyard2.conf -d /var/log/snort -f snort.u2 -w /var/log/snort/barnyard2.waldo \<br />&nbsp; -g snort -u snort<br /><br />Create an alert to watch out for (/etc/snort/rules/local.rules):<br />&nbsp; alert icmp any any -&gt; $HOME_NET any (msg:"ICMP test"; sid:10000001; rev:001;)<br /><br />Create a barnyard service that will run on startup (/etc/init/barnyard2.conf):<br />&nbsp; description "Barnyard2 service"<br />&nbsp; stop on runlevel [!2345]<br />&nbsp; start on runlevel [2345]<br />&nbsp; script<br />&nbsp; exec /usr/local/bin/barnyard2 -c /etc/snort/barnyard2.conf -d /var/log/snort -f snort.u2 -w /var/log/snort<br />&nbsp; /barnyard2.waldo -g snort -u snort -D<br />&nbsp; end script<br /><br />Make the script executable:<br />user@snortserver:~$ sudo chmod +x /etc/init/barnyard2.conf<br />user@snortserver:~$ initctl list | grep barnyard<br />barnyard2 stop/waiting<br />user@snortserver:~$<br /><br />Check all services are running:<br />user@snortserver:~$ service snort status<br />snort start/running, process 1116<br />user@snortserver:~$ service barnyard2 status<br />barnyard2 start/running, process 1109<br />user@snortserver:~$<br /><br />Download and install snorby, ruby application to process barnyard messages.<br />Snorby requires its own database.<br />Create and grant user to 'snorby' database:<br />&nbsp; echo "grant create, insert, select, delete, update on snorby.* to \<br />&nbsp; snorby@localhost identified by 'snorby123'" | mysql -u root -p<br /><br />snorby requirements<br />snort<br />git<br />ruby 1.9.2<br />rails 3.0.0<br />imagemagick 6.6.4<br />wkhtmltopdf<br /><br />snorby is a ruby on rails application, so install rbenv.<br />upgrade ruby:<br />user@snortserver:~$ git clone https://github.com/sstephenson/rbenv.git ~/.rbenv<br />Cloning into '/home/user/.rbenv'...<br />remote: Counting objects: 2057, done.<br />remote: Total 2057 (delta 0), reused 0 (delta 0), pack-reused 2057<br />Receiving objects: 100% (2057/2057), 344.17 KiB | 166 KiB/s, done.<br />Resolving deltas: 100% (1272/1272), done.<br />user@snortserver:~$ echo 'export PATH="$HOME/.rbenv/bin:$PATH"' &gt;&gt; ~/.bashrc<br />user@snortserver:~$ echo 'eval "$(rbenv init -)"' &gt;&gt; ~/.bashrc<br /><br />user@snortserver:~$ type rbenv<br />rbenv is a function<br />rbenv ()<br />{<br />&nbsp; &nbsp; local command;<br />&nbsp; &nbsp; command="$1";<br />&nbsp; &nbsp; if [ "$#" -gt 0 ]; then<br />&nbsp; &nbsp; &nbsp; &nbsp; shift;<br />&nbsp; &nbsp; fi;<br />&nbsp; &nbsp; case "$command" in<br />&nbsp; &nbsp; &nbsp; &nbsp; rehash | shell)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eval "`rbenv "sh-$command" "$@"`"<br />&nbsp; &nbsp; &nbsp; &nbsp; ;;<br />&nbsp; &nbsp; &nbsp; &nbsp; *)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; command rbenv "$command" "$@"<br />&nbsp; &nbsp; &nbsp; &nbsp; ;;<br />&nbsp; &nbsp; esac<br />}<br /><br />&nbsp; rbenv install 2.2.0<br />&nbsp; rbenv global 2.2.0<br />&nbsp; gem install rake<br />&nbsp; gem update --system<br />&nbsp; gem install rubygems-update<br />&nbsp; update_rubygems<br />&nbsp; gem install rails<br /><br />Download snorby<br />&nbsp; git clone https://github.com/Snorby/snorby<br /><br />Edit snorby config:<br />&nbsp; vi config/snorby_config.yml<br />&nbsp; # If timezone_search is undefined or false, searching based on time will<br />&nbsp; # use UTC times (historical behavior). If timezone_search is true<br />&nbsp; # searching will use local time.<br />&nbsp; timezone_search: true<br />&nbsp; # uncomment to set time zone to time zone of box from /usr/share/zoneinfo, e.g. "America/Cancun"<br />&nbsp; # time_zone: 'UTC'<br /><br />Install snorby: <br />&nbsp; cd snorby<br />&nbsp; bundle install<br /><br />If you encounter problem with json:<br />In file included from generator.c:1:0:<br />../fbuffer/fbuffer.h: In function â€˜fbuffer_to_sâ€™:<br />../fbuffer/fbuffer.h:175:47: error: macro "rb_str_new" requires 2 arguments, but only 1 given<br />../fbuffer/fbuffer.h:175:20: warning: initialization makes integer from pointer without a cast [enabled by default]<br />make: *** [generator.o] Error 1<br /><br />make failed, exit code 2<br /><br />then install latest json:<br />&nbsp; gem install json<br />&nbsp; bundle update json<br /><br />If you encounter problem with eventmachine:<br />em.cpp: In member function â€˜void EventMachine_t::_RunEpollOnce()â€™:<br />em.cpp:574:37: error: â€˜rb_thread_selectâ€™ was not declared in this scope<br />em.cpp: In member function â€˜int SelectData_t::_Select()â€™:<br />em.cpp:827:67: error: â€˜rb_thread_selectâ€™ was not declared in this scope<br />em.cpp: In member function â€˜void EventMachine_t::_RunSelectOnce()â€™:<br />em.cpp:946:40: error: â€˜rb_thread_selectâ€™ was not declared in this scope<br />make: *** [em.o] Error 1<br /><br />make failed, exit code 2<br /><br />the install latest eventmachine:<br />&nbsp; bundle update eventmachine<br /><br />Once bundle install passes:<br />&nbsp; rake snorby:setup<br />&nbsp; rails -e production<br /><br />Now you can access snorby:<br />http://localhost/snorby<br />user: snorby@example.com<br />pass: snorby<br />NB! Change your password!<br /><br />You can run snorby as a standalone application or you can use passenger/apache to start with web server (not covered in this guide).<br />&nbsp;